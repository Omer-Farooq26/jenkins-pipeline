// Build & run a tiny image using the HOST's Docker (no DinD).
pipeline {
  agent any   // run directly on the Jenkins node (EC2)

  options { timestamps() }

  stages {
    stage('Check Docker') {
      steps {
        sh 'docker --version'
        sh 'id'                  // helpful to confirm user/groups
        sh 'ls -l /var/run/docker.sock'
      }
    }

    stage('Build Image') {
      steps {
        sh '''
          cat > Dockerfile <<'EOF'
          FROM alpine:3.19
          CMD echo "Hello from Docker!"
          EOF

          docker build -t my-test-image .
        '''
      }
    }

    stage('Run Container') {
      steps {
        sh 'docker run --rm my-test-image'
      }
    }
  }

  post {
    always { echo "Result: ${currentBuild.currentResult}" }
  }
}

