// Use HOST Docker (no DinD). Simple end-to-end prove.
pipeline {
  agent any
  options { timestamps() }

  stages {
    stage('Check Docker') {
      steps {
        sh 'whoami'
        sh 'id'
        sh 'docker --version'
        sh 'ls -l /var/run/docker.sock'
        sh 'docker ps'
      }
    }

    stage('Build Image') {
      steps {
        sh '''
          cat > Dockerfile <<'EOF'
          FROM alpine:3.19
          CMD echo "Hello from Docker!"
          EOF

          docker build -t my-test-image .
        '''
      }
    }

    stage('Run Container') {
      steps {
        sh 'docker run --rm my-test-image'
      }
    }
  }

  post {
    always { echo "Build finished: ${currentBuild.currentResult}" }
  }
}

